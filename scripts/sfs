#!/bin/sh

# Setup vars
	# Data home
	SFSMNT="$HOME/.local/mnt"
	SFSARGS="$@"
	SDLOG=$SFSMNT/known_dir_log
# Setup Functs
	# Start up sshfs
	SUSfs(){
		for CSMADDR in $(cat $SDLOG)
		do
			sshfs -o transform_symlinks $CSMADDR:/ $SFSMNT/$CSMADDR
		done
	}
	# Make new dirs for sshfs
	MkSfsDir(){
		for CMDIR in $SFSARGS
		do
			SNADD=$(grep "^$CMDIR$" $SDLOG 2> /dev/null)
			[ -z "$SNADD" ] \
			&& mkdir $SFSMNT/$CMDIR \
			&& echo $CMDIR >> $SDLOG \
			|| echo "$SNADD already in log" >&2 
		done
	}
	# Kill old prosses
	KlSfs(){
		for SDKL in $(cat $SDLOG)
		do
			pkill -9 sshfs
			fusermount -uzq $SFSMNT/$SDKL
		done
	}
# Run everything
	mkdir $SFSMNT 2> /dev/null && $(
		MkSfsDir && SUSfs) && exit
	[ -z "$1" ] && $(
		KlSfs ; SUSfs)&& exit
	[ "$1" != "-k" ] && $(
		KlSfs ; MkSfsDir && SUSfs) && exit
	KlSfs || echo "Nothing to do"